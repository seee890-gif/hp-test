# 製造業受注管理システム 仕様書

## 1. システム概要

### 1.1 目的
中規模製造業（従業員10〜100名）向けの受注管理システム。
受注から生産、出荷までの一連のプロセスを統合管理し、業務効率化と納期遵守率の向上を実現する。

### 1.2 対象ユーザー
- 営業担当者（見積・受注入力）
- 生産管理担当者（スケジュール管理）
- 在庫管理担当者（部品・原材料管理）
- 経営層（ダッシュボード閲覧）
- システム管理者（マスタ管理）

### 1.3 技術スタック
| 項目 | 技術 |
|------|------|
| フロントエンド | Next.js 15 (App Router) |
| バックエンド | Next.js Server Actions |
| データベース | PostgreSQL (Supabase) |
| 認証 | Supabase Auth |
| UI | Tailwind CSS + shadcn/ui |
| 帳票出力 | React PDF |
| ホスティング | Vercel |

---

## 2. 機能要件

### 2.1 受注・見積管理

#### 見積管理
| 機能 | 説明 |
|------|------|
| 見積作成 | 顧客・製品・数量・単価を入力し見積書を作成 |
| 見積一覧 | ステータス別（作成中/提出済/成約/失注）で管理 |
| 見積PDF出力 | 見積書をPDF形式で出力 |
| 見積→受注変換 | 成約した見積を受注データに変換 |

#### 受注管理
| 機能 | 説明 |
|------|------|
| 受注登録 | 顧客・製品・数量・希望納期を登録 |
| 受注一覧 | ステータス別（受付/生産中/出荷待ち/完了）で管理 |
| 受注詳細 | 受注内容・進捗・履歴を表示 |
| 納期アラート | 納期が近い受注を警告表示 |

### 2.2 在庫・部品管理

#### 在庫管理
| 機能 | 説明 |
|------|------|
| 在庫一覧 | 部品・原材料の現在庫を表示 |
| 入出庫記録 | 入庫・出庫の履歴を記録 |
| 在庫調整 | 棚卸による在庫数の調整 |
| 発注点管理 | 在庫が発注点を下回った場合にアラート |

#### 部品マスタ
| 機能 | 説明 |
|------|------|
| 部品登録 | 部品名・型番・単価・発注点を登録 |
| BOM（部品表） | 製品ごとに必要な部品と数量を定義 |
| 仕入先管理 | 部品ごとの仕入先情報を管理 |

### 2.3 生産スケジュール管理

#### 生産計画
| 機能 | 説明 |
|------|------|
| 生産指示作成 | 受注に基づいて生産指示を作成 |
| ガントチャート | 生産スケジュールを視覚的に表示 |
| 負荷調整 | 設備・人員の負荷状況を確認・調整 |
| 進捗更新 | 各工程の進捗をリアルタイムで更新 |

#### 工程管理
| 機能 | 説明 |
|------|------|
| 工程マスタ | 製品ごとの工程フローを定義 |
| 作業実績入力 | 各工程の開始・完了時刻を記録 |
| 不良記録 | 不良発生時の記録と原因分析 |

### 2.4 顧客管理

| 機能 | 説明 |
|------|------|
| 顧客登録 | 会社名・担当者・連絡先を登録 |
| 取引履歴 | 顧客ごとの見積・受注履歴を表示 |
| 与信管理 | 与信限度額と残高を管理 |

### 2.5 ダッシュボード

| 機能 | 説明 |
|------|------|
| 売上サマリー | 月次・年次の売上推移を表示 |
| 受注状況 | 未処理受注・進行中受注の件数を表示 |
| 在庫アラート | 発注点以下の部品を一覧表示 |
| 納期遅延リスク | 納期遅延リスクのある受注を表示 |

---

## 3. 画面一覧

### 3.1 共通
- ログイン画面
- ダッシュボード
- ユーザー設定

### 3.2 受注・見積
- 見積一覧 / 見積作成・編集 / 見積詳細
- 受注一覧 / 受注作成・編集 / 受注詳細

### 3.3 在庫
- 在庫一覧 / 入出庫登録 / 在庫調整
- 部品マスタ一覧 / 部品登録・編集
- BOM一覧 / BOM作成・編集

### 3.4 生産
- 生産計画一覧 / 生産指示作成
- ガントチャート
- 作業実績入力

### 3.5 マスタ
- 顧客一覧 / 顧客登録・編集
- 製品マスタ / 工程マスタ
- ユーザー管理（管理者のみ）

---

## 4. データベース設計

### 4.1 主要テーブル

```
-- 顧客
customers (id, name, contact_person, email, phone, address, credit_limit, created_at)

-- 製品
products (id, name, code, description, unit_price, lead_time_days, created_at)

-- 部品・原材料
parts (id, name, code, unit, unit_cost, reorder_point, supplier_id, created_at)

-- BOM（部品表）
bom (id, product_id, part_id, quantity)

-- 見積
quotes (id, customer_id, quote_number, status, total_amount, valid_until, created_at)
quote_items (id, quote_id, product_id, quantity, unit_price, amount)

-- 受注
orders (id, customer_id, quote_id, order_number, status, due_date, total_amount, created_at)
order_items (id, order_id, product_id, quantity, unit_price, amount)

-- 在庫
inventory (id, part_id, quantity, location, updated_at)
inventory_transactions (id, part_id, type, quantity, reference_type, reference_id, created_at)

-- 生産
production_orders (id, order_id, product_id, quantity, status, planned_start, planned_end, created_at)
production_processes (id, production_order_id, process_id, status, started_at, completed_at)

-- 工程マスタ
processes (id, product_id, name, sequence, standard_time_minutes)

-- ユーザー
users (id, email, name, role, department, created_at)
```

### 4.2 ステータス定義

| テーブル | ステータス |
|---------|-----------|
| quotes | draft, submitted, won, lost |
| orders | pending, confirmed, in_production, ready_to_ship, shipped, completed, cancelled |
| production_orders | planned, in_progress, completed, on_hold |

---

## 5. 権限管理

| ロール | 権限 |
|--------|------|
| admin | 全機能アクセス可、ユーザー管理 |
| sales | 見積・受注・顧客管理 |
| production | 生産計画・作業実績・在庫参照 |
| inventory | 在庫管理・部品マスタ |
| viewer | 全画面参照のみ |

---

## 6. 非機能要件

### 6.1 パフォーマンス
- 画面表示: 3秒以内
- 一覧表示: 1000件まで1秒以内
- 同時接続: 50ユーザー

### 6.2 セキュリティ
- HTTPS通信必須
- パスワードポリシー（8文字以上、英数字混在）
- セッションタイムアウト（30分）
- 操作ログの記録

### 6.3 可用性
- 稼働時間: 99.5%（月間）
- バックアップ: 日次自動バックアップ

---

## 7. 開発フェーズ

### Phase 1（MVP）
- [ ] 認証機能（ログイン/ログアウト）
- [ ] 顧客マスタ管理
- [ ] 製品マスタ管理
- [ ] 受注管理（基本CRUD）
- [ ] ダッシュボード（基本）

### Phase 2
- [ ] 見積管理
- [ ] 見積→受注変換
- [ ] 部品マスタ・BOM管理
- [ ] 在庫管理

### Phase 3
- [ ] 生産スケジュール管理
- [ ] ガントチャート
- [ ] 作業実績入力
- [ ] PDF帳票出力

### Phase 4
- [ ] 納期アラート
- [ ] 在庫アラート
- [ ] レポート機能
- [ ] 与信管理

---

## 8. 今後の拡張予定

- モバイル対応（現場でのバーコード読み取り）
- 外部システム連携（会計ソフト、EDI）
- AI需要予測
- IoT連携（設備稼働監視）
